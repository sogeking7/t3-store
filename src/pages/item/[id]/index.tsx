import {
	type GetServerSideProps,
	type InferGetServerSidePropsType,
	type NextPage
} from 'next'
import Head from 'next/head'
import { Header } from 'components/layout/header/header'
import { api } from '~/utils/api'
import { Loader } from '@mantine/core'
import { Item } from 'components/pages/item/item'

const ItemPage: NextPage = ({
	query
}: InferGetServerSidePropsType<typeof getServerSideProps>) => {
	const { data, isLoading } = api.product.getProductById.useQuery({
		id: query.id
	})
	if (isLoading) {
		return (
			<div className='basis-3/4 mt-8'>
				<Loader className='mx-auto' />
			</div>
		)
	}
	if (!isLoading && !data) {
		return <>{'No Data'}</>
	}
	return (
		<>
			<Head>
				<title>{data!.title}</title>
				<meta name='description' content='Generated by create-t3-app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>
			<Header />
			<main className='font-body cont-t'>
				<div className='flex pt-4 gap-12'>
					<Item
						data={{
							id: data!.id,
							title: data!.title,
							description: data!.description,
							brand: data!.brand,
							price: data!.price,
							rating: data!.rating,
							images: data!.images
						}}
					/>
				</div>
			</main>
		</>
	)
}
// @ts-ignore comment 
export const getServerSideProps: GetServerSideProps = ctx => {
	const query = ctx.params
	return { props: { query } }
}

export default ItemPage
